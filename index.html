<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üìä Mi Biblioteca de Gr√°ficos</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    /* Tema oscuro por defecto */
    color-scheme: dark;
    --bg: #0b0f14;
    --bg-accent: radial-gradient(1200px 600px at 20% -10%, rgba(59,130,246,.10), transparent 50%),
                 radial-gradient(900px 500px at 120% 0%, rgba(16,185,129,.10), transparent 60%),
                 linear-gradient(180deg, #0b0f14, #090d12 60%);
    --panel: #0f1520;
    --card: #111827;
    --muted: #9aa3b2;
    --fg: #e5e7eb;
    --brand: #60a5fa;
    --brand-2: #34d399;
    --ring: 0 0 0 3px rgba(96,165,250,.35);
    --shadow: 0 14px 40px rgba(0,0,0,.45);
    --border: rgba(255,255,255,.08);
    --pv-scale: .37; /* escala inicial de vista previa */
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg: #f5f7fa;
      --bg-accent: radial-gradient(1200px 600px at 20% -10%, rgba(59,130,246,.12), transparent 50%),
                   radial-gradient(900px 500px at 120% 0%, rgba(16,185,129,.12), transparent 60%),
                   linear-gradient(180deg, #f5f7fa, #f1f5f9 60%);
      --panel:#ffffff;
      --card:#ffffff;
      --muted:#6b7280;
      --fg:#111827;
      --brand:#2563eb;
      --brand-2:#059669;
      --shadow: 0 14px 30px rgba(0,0,0,.12);
      --border: rgba(17,24,39,.1);
    }
  }

  html,body{height:100%}
  body{
    margin:0; background: var(--bg-accent); color:var(--fg);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    line-height:1.45;
  }
  .wrap{ max-width:1200px; margin:0 auto; padding:28px 20px 64px; }

  header{
    display:flex; align-items:center; justify-content:space-between; gap:14px;
    padding:14px 16px; border:1px solid var(--border);
    border-radius:18px; box-shadow:var(--shadow);
    position:sticky; top:12px; z-index:5; backdrop-filter: blur(10px);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  }
  .title{display:flex; align-items:center; gap:12px;}
  .logo{
    width:40px;height:40px;border-radius:10px; display:grid; place-items:center;
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    color:white; font-weight:900; letter-spacing:.3px; box-shadow:var(--shadow);
  }
  h1{margin:0; font-size:clamp(18px,2.2vw,24px)}
  .muted{color:var(--muted); font-size:12px}

  .tools{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
  .search{ position:relative; }
  .search input{
    width:min(46vw,360px); padding:10px 38px 10px 36px; border-radius:12px;
    border:1px solid var(--border); background:var(--panel); color:var(--fg);
    outline:none; transition:.2s;
  }
  .search input:focus{ box-shadow: var(--ring); border-color: transparent; }
  .search .icon{ position:absolute; left:10px; top:50%; transform: translateY(-50%); opacity:.7; pointer-events:none; }

  .btn, .segmented button{
    padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:var(--panel); color:var(--fg); cursor:pointer; transition:.15s;
  }
  .btn:hover, .segmented button:hover{ filter: brightness(1.06); }
  .segmented{ display:flex; border:1px solid var(--border); border-radius:12px; overflow:hidden; }
  .segmented button{ border:0; }
  .segmented button[aria-pressed="true"]{ background: linear-gradient(135deg, var(--brand), var(--brand-2)); color:#fff; }

  .grid{
    display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap:16px; margin-top:18px;
  }
  .list{ display:flex; flex-direction:column; gap:12px; margin-top:18px; }

  .card{
    position:relative; border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    border-radius:16px; padding:14px; box-shadow: var(--shadow);
    transition: transform .18s ease, border-color .18s ease, background .18s ease;
    overflow:hidden; outline:none;
  }
  .card:hover, .card:focus{ transform: translateY(-2px); border-color: rgba(99,102,241,.35); }
  .badge{ font-size:11px; color:var(--muted); display:flex; align-items:center; gap:6px; margin-bottom:6px;}
  .card h3{ margin:6px 0 8px; font-size:16px; line-height:1.25; letter-spacing:.2px; }
  .desc{ color:var(--muted); min-height:2.1em; }
  .tags{ display:flex; gap:6px; flex-wrap:wrap; margin-top:8px; }
  .tag{ font-size:11px; padding:3px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted); }

  .actions{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-top:12px; }
  .open{
    flex:1; text-decoration:none; font-weight:700; color:white;
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    padding:9px 12px; border-radius:12px; display:flex; justify-content:center; align-items:center; gap:8px;
  }
  .icon-btn{
    border:1px solid var(--border); background:var(--panel); border-radius:10px;
    width:40px; height:40px; display:grid; place-items:center; cursor:pointer;
  }

  /* PREVIEW */
  .preview{
    position:fixed; width:520px; height:360px; display:none; z-index:60;
    border:1px solid var(--border); background:var(--card); border-radius:16px; box-shadow: var(--shadow); overflow:hidden;
  }
  .preview.floating{ inset:auto auto 0 0; } /* se posiciona por JS */
  .preview.docked{ right:18px; top:90px; display:block; }
  .preview header{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:8px 10px; border-bottom:1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  }
  .frame-wrap{ position:relative; width:100%; height:100%; background:var(--panel); }
  iframe{
    position:absolute; inset:auto auto 0 0;
    width:1200px; height:800px; transform-origin: bottom left;
    transform: scale(var(--pv-scale)); border:0; background:white;
    pointer-events: none; /* seguro por defecto */
  }
  .preview.interactive iframe{ pointer-events:auto; }
  .fallback{
    position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:center;
    color:var(--muted); padding:24px; font-size:14px;
  }
  .preview.error .fallback{ display:flex; }
  .preview.error iframe{ display:none; }

  /* Oculta la lista original */
  #links{ display:none; }

  /* Toast */
  .toast{
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    background:var(--panel); border:1px solid var(--border); color:var(--fg);
    padding:10px 14px; border-radius:10px; box-shadow:var(--shadow); z-index:80; font-size:13px; display:none;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo">üìä</div>
        <div>
          <h1>Mi Biblioteca de Gr√°ficos</h1>
          <div class="muted">Hover para previsualizar ‚Ä¢ Enter para abrir ‚Ä¢ P para fijar preview</div>
        </div>
      </div>
      <div class="tools">
        <div class="search">
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M21 21l-4.3-4.3m1.8-4.2a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z"/></svg>
          <input id="q" type="search" placeholder="Buscar por t√≠tulo, archivo o etiqueta‚Ä¶" aria-label="Buscar" />
        </div>
        <div class="segmented" role="group" aria-label="Vista">
          <button id="btnGrid" aria-pressed="true" title="Vista en tarjetas">‚¨ö</button>
          <button id="btnList" aria-pressed="false" title="Vista en lista">‚ò∞</button>
        </div>
        <select id="sort" class="btn" title="Ordenar">
          <option value="name-asc">Nombre (A‚ÄìZ)</option>
          <option value="name-desc">Nombre (Z‚ÄìA)</option>
          <option value="file-asc">Archivo (A‚ÄìZ)</option>
          <option value="file-desc">Archivo (Z‚ÄìA)</option>
        </select>
        <button class="btn" id="toggleTheme" title="Claro/Oscuro">üåì</button>
      </div>
    </header>

    <section id="container" class="grid"></section>

    <!-- PREVIEW -->
    <div id="preview" class="preview floating" role="dialog" aria-label="Vista previa" aria-hidden="true">
      <header>
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <span class="tag" id="pvFile">archivo.html</span>
          <span class="muted" id="pvHint">Vista previa (solo lectura)</span>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <label class="muted" for="pvScale" style="font-size:12px;">Zoom</label>
          <input id="pvScale" type="range" min="25" max="70" value="37" />
          <button class="btn" id="pvInteract" title="Permitir interacci√≥n">üñ±Ô∏è</button>
          <button class="btn" id="pvDock" title="Anclar/Desanclar">üìå</button>
          <button class="btn" id="pvClose" title="Cerrar">‚úï</button>
        </div>
      </header>
      <div class="frame-wrap">
        <iframe id="pvFrame" referrerpolicy="no-referrer"></iframe>
        <div class="fallback" id="pvFallback">No se pudo cargar la vista previa. Abre el archivo para verlo.</div>
      </div>
    </div>

    <!-- Lista original (puedes a√±adir data-desc y data-tags) -->
    <ul id="links">
      <li><a href="burbujas-3.html" target="_blank" data-desc="Burbujas din√°micas en el tiempo" data-tags="burbujas, timeline">burbujas-3</a></li>
      <li><a href="series-deficithab-nacional.html" target="_blank" data-desc="Serie del d√©ficit habitacional nacional (%)" data-tags="series, d√©ficit, nacional">series deficit nacional%</a></li>
      <li><a href="serie-defhab-4.html" target="_blank" data-desc="Variaci√≥n por a√±os, versi√≥n 4" data-tags="series, d√©ficit">series deficit nacional%4</a></li>
      <li><a href="serie-defhababs-1.html" target="_blank" data-desc="D√©ficit habitacional (valores absolutos)" data-tags="series, absolutos">series deficit nacional(abs)1</a></li>
      <li><a href="serie-defcuanti-enaho-1.html" target="_blank" data-desc="D√©ficit cuantitativo (ENAHO)" data-tags="enaho, cuantitativo">series deficit nacional cuanti 1</a></li>
      <li><a href="serie-defcuali-enaho-1.html" target="_blank" data-desc="D√©ficit cualitativo (ENAHO)" data-tags="enaho, cualitativo">series deficit nacional cuali 1</a></li>
    </ul>
  </div>

  <div class="toast" id="toast"></div>

<script>
  const $ = (q, el=document)=> el.querySelector(q);
  const $$ = (q, el=document)=> Array.from(el.querySelectorAll(q));

  const container = $('#container');
  const preview = $('#preview'), pvFrame = $('#pvFrame'), pvFile = $('#pvFile'), pvFallback = $('#pvFallback');
  const pvScale = $('#pvScale'), pvDock = $('#pvDock'), pvClose = $('#pvClose'), pvInteract = $('#pvInteract');
  const q = $('#q'), sortSel = $('#sort'), btnGrid=$('#btnGrid'), btnList=$('#btnList');
  const toastEl = $('#toast');

  // Tema: toggle claro/oscuro (persistente)
  (function themeInit(){
    const saved = localStorage.getItem('theme');
    if(saved) document.documentElement.style.colorScheme = saved;
    $('#toggleTheme').addEventListener('click', ()=>{
      const current = getComputedStyle(document.documentElement).colorScheme;
      const next = current==='dark' ? 'light' : 'dark';
      document.documentElement.style.colorScheme = next;
      localStorage.setItem('theme', next);
      ping('Tema: '+ (next==='dark'?'oscuro':'claro'));
    });
  })();

  // Construye modelo desde lista original
  const items = $$('#links a').map(a => ({
    href: a.getAttribute('href'),
    text: (a.textContent||'').trim(),
    desc: a.dataset.desc || '',
    tags: (a.dataset.tags || inferTags(a.textContent||'')).split(',').map(s=>s.trim()).filter(Boolean)
  }));

  function inferTags(name){
    // Etiquetas sugeridas desde el nombre del archivo
    const t = [];
    const s = name.toLowerCase();
    if(/burbuja|bubble/.test(s)) t.push('burbujas');
    if(/serie|series|timeline/.test(s)) t.push('series');
    if(/deficit|deficithab/.test(s)) t.push('d√©ficit');
    if(/enaho/.test(s)) t.push('enaho');
    if(/nacional/.test(s)) t.push('nacional');
    return t.join(', ');
  }

  function extIcon(){
    return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9l-6-6zm1 7h5l-6-6v5a1 1 0 0 0 1 1z"/></svg>`;
  }
  function linkIcon(){
    return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10.59 13.41a1.98 1.98 0 010-2.82l2.59-2.59a2 2 0 112.83 2.83l-1.42 1.41"/><path d="M13.41 10.59a1.98 1.98 0 010 2.82l-2.59 2.59a2 2 0 11-2.83-2.83l1.42-1.41"/></svg>`;
  }
  function eyeIcon(){
    return `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 11a4 4 0 110-8 4 4 0 010 8z"/></svg>`;
  }
  function copyIcon(){
    return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 00-2 2v12h2V3h12V1zm3 4H8a2 2 0 00-2 2v14a2 2 0 002 2h11a2 2 0 002-2V7a2 2 0 00-2-2zm0 16H8V7h11v14z"/></svg>`;
  }
  function codeIcon(){
    return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 17l-5-5 5-5M16 7l5 5-5 5M13 6l-2 12"/></svg>`;
  }

  function makeCard(it, idx){
    const el = document.createElement('article');
    el.className = 'card';
    el.tabIndex = 0;
    el.dataset.index = idx;
    el.innerHTML = `
      <div class="badge">${extIcon()} <span>${it.href}</span></div>
      <h3>${it.text}</h3>
      <p class="desc">${it.desc}</p>
      <div class="tags">${it.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
      <div class="actions">
        <a class="open" href="${it.href}" target="_blank" rel="noopener">${linkIcon()} Abrir</a>
        <button class="icon-btn peek" title="Vista previa">${eyeIcon()}</button>
        <button class="icon-btn copy" title="Copiar enlace">${copyIcon()}</button>
        <button class="icon-btn embed" title="Copiar iframe">${codeIcon()}</button>
      </div>
    `;

    // Hover preview
    let hideTimer, showTimer;
    const show = (evt, sticky=false)=>{
      clearTimeout(hideTimer);
      clearTimeout(showTimer);
      showTimer = setTimeout(()=>{
        preview.classList.remove('error');
        pvFallback.textContent = 'Cargando vista previa‚Ä¶';
        pvFile.textContent = it.href;
        pvFrame.removeAttribute('src'); // reinicia
        pvFrame.src = it.href;
        if(!preview.classList.contains('docked')){
          preview.style.display='block';
          positionPreview(evt);
          preview.classList.add('floating');
        }
        preview.setAttribute('aria-hidden','false');
        preview.dataset.sticky = sticky ? '1' : '';
      }, 120);
    };
    const hide = ()=>{
      if(preview.dataset.sticky==='1' || preview.classList.contains('docked')) return;
      hideTimer = setTimeout(()=>{
        preview.style.display='none';
        preview.setAttribute('aria-hidden','true');
        pvFrame.removeAttribute('src');
      }, 120);
    };

    el.addEventListener('mouseenter', e=> show(e));
    el.addEventListener('mousemove', e=> positionPreview(e));
    el.addEventListener('mouseleave', hide);
    el.querySelector('.peek').addEventListener('click', (e)=>{ e.stopPropagation(); toggleSticky(it, e); });
    el.querySelector('.copy').addEventListener('click', ()=> copyLink(it.href));
    el.querySelector('.embed').addEventListener('click', ()=> copyEmbed(it.href));
    el.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){ window.open(it.href, '_blank', 'noopener'); }
      if(e.key.toLowerCase()==='p'){ toggleSticky(it, e); }
    });
    return el;
  }

  function render(list, mode='grid'){
    container.className = mode==='grid' ? 'grid' : 'list';
    container.innerHTML = '';
    list.forEach((it,i)=> container.appendChild(makeCard(it, i)));
  }

  // Posiciona preview flotante
  function positionPreview(evt){
    const pad=16, w=520, h=360;
    let x = evt.clientX + 18, y = evt.clientY + 18;
    const vw = window.innerWidth, vh = window.innerHeight;
    if(x + w + pad > vw) x = vw - w - pad;
    if(y + h + pad > vh) y = vh - h - pad;
    preview.style.left = x + 'px';
    preview.style.top  = y + 'px';
  }

  function toggleSticky(it, e){
    const sticky = preview.dataset.sticky==='1';
    if(sticky){
      preview.dataset.sticky='';
      if(!preview.classList.contains('docked')){
        preview.style.display='none';
        pvFrame.removeAttribute('src');
      }
    }else{
      preview.style.display='block';
      preview.dataset.sticky='1';
      if(!preview.classList.contains('docked')){
        positionPreview(e);
      }
      if(pvFrame.src !== new URL(it.href, location.href).toString()){
        pvFrame.src = it.href;
      }
      pvFile.textContent = it.href;
    }
  }

  // Preview controls
  pvClose.addEventListener('click', ()=>{
    preview.dataset.sticky=''; preview.classList.remove('docked','interactive');
    preview.style.display='none'; pvFrame.removeAttribute('src');
  });
  pvDock.addEventListener('click', ()=>{
    const docked = preview.classList.toggle('docked');
    if(docked){
      preview.style.display='block'; preview.dataset.sticky='1'; preview.classList.remove('floating');
    }else{
      preview.classList.add('floating');
    }
  });
  pvInteract.addEventListener('click', ()=>{
    preview.classList.toggle('interactive');
    pvInteract.textContent = preview.classList.contains('interactive') ? 'üö´' : 'üñ±Ô∏è';
    pvInteract.title = preview.classList.contains('interactive') ? 'Bloquear interacci√≥n' : 'Permitir interacci√≥n';
  });
  pvScale.addEventListener('input', ()=>{
    document.documentElement.style.setProperty('--pv-scale', (pvScale.value/100).toString());
  });
  pvFrame.addEventListener('error', ()=> preview.classList.add('error'));
  pvFrame.addEventListener('load', ()=>{
    // Si hay restricci√≥n CORS o contenido vac√≠o, marcamos error
    try{
      const ok = pvFrame.contentDocument && pvFrame.contentDocument.body && pvFrame.contentDocument.body.innerHTML.trim()!=='';
      preview.classList.toggle('error', !ok);
      if(!ok) pvFallback.textContent = 'Este archivo no permite vista previa embebida.';
    }catch(_){
      preview.classList.add('error');
      pvFallback.textContent = 'Este archivo no permite vista previa embebida.';
    }
  });

  // Buscar / filtrar / ordenar
  function applyFilter(){
    const term = q.value.trim().toLowerCase();
    const sorted = sortItems(items.slice(), sortSel.value);
    const filtered = term
      ? sorted.filter(it => (it.text+' '+it.href+' '+it.desc+' '+it.tags.join(' ')).toLowerCase().includes(term))
      : sorted;
    render(filtered, viewMode);
  }
  function sortItems(arr, mode){
    const dir = mode.endsWith('desc') ? -1 : 1;
    const key = mode.startsWith('file') ? (it)=> it.href.toLowerCase() : (it)=> it.text.toLowerCase();
    return arr.sort((a,b)=> key(a) > key(b) ? dir : key(a) < key(b) ? -dir : 0);
  }
  q.addEventListener('input', applyFilter);
  sortSel.addEventListener('change', applyFilter);

  // Vista grid/lista
  let viewMode = 'grid';
  btnGrid.addEventListener('click', ()=> { viewMode='grid'; btnGrid.setAttribute('aria-pressed','true'); btnList.setAttribute('aria-pressed','false'); render(sortItems(items.slice(), sortSel.value), viewMode); });
  btnList.addEventListener('click', ()=> { viewMode='list'; btnGrid.setAttribute('aria-pressed','false'); btnList.setAttribute('aria-pressed','true'); render(sortItems(items.slice(), sortSel.value), viewMode); });

  // Copiar utilidades
  async function copyLink(href){
    try{
      await navigator.clipboard.writeText(new URL(href, location.href).toString());
      ping('Enlace copiado');
    }catch{ ping('No se pudo copiar'); }
  }
  async function copyEmbed(href){
    const url = new URL(href, location.href).toString();
    const code = `<iframe src="${url}" width="100%" height="480" frameborder="0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
    try{
      await navigator.clipboard.writeText(code);
      ping('C√≥digo iframe copiado');
    }catch{ ping('No se pudo copiar'); }
  }
  function ping(msg){
    toastEl.textContent = msg; toastEl.style.display='block'; toastEl.style.opacity='1';
    clearTimeout(toastEl._t); toastEl._t = setTimeout(()=> toastEl.style.display='none', 1300);
  }

  // Navegaci√≥n por teclado global
  document.addEventListener('keydown', (e)=>{
    const key = e.key.toLowerCase();
    const cards = $$('.card');
    const active = document.activeElement.closest?.('.card');
    let idx = active ? Number(active.dataset.index) : -1;
    if(key==='j'){ // siguiente
      e.preventDefault();
      idx = Math.min((idx+1), cards.length-1);
      if(idx>=0) cards[idx].focus({preventScroll:false});
    }
    if(key==='k'){ // anterior
      e.preventDefault();
      idx = Math.max((idx-1), 0);
      cards[idx].focus({preventScroll:false});
    }
    if(key==='p'){ // toggle preview
      e.preventDefault();
      if(idx>=0){
        const it = items[idx];
        toggleSticky(it, e);
      }
    }
    if(key==='g'){ // grid/lista
      e.preventDefault();
      (viewMode==='grid'?btnList:btnGrid).click();
    }
    if(key==='d'){ // anclar/desanclar
      e.preventDefault();
      pvDock.click();
    }
    if(e.key==='Escape'){
      pvClose.click();
    }
  });

  // Render inicial
  applyFilter();
</script>
</body>
</html>
