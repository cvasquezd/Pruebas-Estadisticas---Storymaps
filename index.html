<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üìä Mi Biblioteca de Gr√°ficos</title>
<style>
  :root{ --pv-scale:.37; --radius:16px; --radius-sm:12px; }

  /* ===== THEME ===== */
  html[data-theme="dark"]{
    color-scheme: dark;
    --bg:#0b0f14;
    --bg-accent:
      radial-gradient(1200px 600px at 20% -10%, rgba(59,130,246,.10), transparent 50%),
      radial-gradient(900px 500px at 120% 0%, rgba(16,185,129,.10), transparent 60%),
      linear-gradient(180deg,#0b0f14,#090d12 60%);
    --panel:#0f1520;
    --card:#111827;
    --muted:#9aa3b2;
    --fg:#e5e7eb;
    --ring:0 0 0 3px rgba(96,165,250,.35);
    --shadow:0 14px 40px rgba(0,0,0,.45);
    --border:rgba(255,255,255,.10);
    --btn:#1f2937;
  }
  html[data-theme="light"]{
    color-scheme: light;
    --bg:#f5f7fa;
    --bg-accent:
      radial-gradient(1200px 600px at 20% -10%, rgba(59,130,246,.12), transparent 50%),
      radial-gradient(900px 500px at 120% 0%, rgba(16,185,129,.12), transparent 60%),
      linear-gradient(180deg,#f5f7fa,#f1f5f9 60%);
    --panel:#ffffff;
    --card:#ffffff;
    --muted:#6b7280;
    --fg:#111827;
    --ring:0 0 0 3px rgba(37,99,235,.35);
    --shadow:0 14px 30px rgba(0,0,0,.12);
    --border:rgba(17,24,39,.12);
    --btn:#f3f4f6;
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg-accent); color:var(--fg);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial; line-height:1.45;
  }
  .wrap{ max-width:1220px; margin:0 auto; padding:24px 16px 64px; }

  /* ===== TOP ===== */
  header{
    display:flex; align-items:center; justify-content:space-between; gap:14px;
    padding:12px 14px; border:1px solid var(--border);
    border-radius:18px; box-shadow:var(--shadow);
    position:sticky; top:12px; z-index:5; backdrop-filter:blur(10px);
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
  }
  .title{display:flex; align-items:center; gap:12px;}
  .logo{ width:40px;height:40px;border-radius:10px; display:grid; place-items:center;
    background:var(--panel); color:var(--fg); font-weight:900; box-shadow:var(--shadow); }
  h1{margin:0; font-size:clamp(18px,2.2vw,24px)}
  .muted{color:var(--muted); font-size:12px}
  .tools{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
  .search{ position:relative; }
  .search input{
    width:min(44vw,360px); padding:10px 38px 10px 36px; border-radius:12px;
    border:1px solid var(--border); background:var(--panel); color:var(--fg); outline:none; transition:.2s;
  }
  .search input:focus{ box-shadow: var(--ring); border-color: transparent; }
  .search .icon{ position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.7; pointer-events:none; }
  .btn{
    padding:10px 12px; border-radius:12px; border:1px solid var(--border);
    background:var(--btn); color:var(--fg); cursor:pointer; transition:.15s;
  }
  .btn:hover{ filter:brightness(1.06); }

  /* ===== CONTENEDOR GRUPOS ===== */
  .groups{ display:flex; flex-direction:column; gap:18px; margin-top:16px; }

  /* ===== FICHERO (ACORDE√ìN) ===== */
  details.group{
    border:1px solid var(--border);
    border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    box-shadow:var(--shadow); overflow:hidden;
  }
  details.group > summary{
    list-style:none; cursor:pointer; user-select:none;
    padding:12px 14px; display:flex; align-items:center; justify-content:space-between; gap:10px;
    position:sticky; top:0; background:linear-gradient(180deg, rgba(255,255,255,.05), transparent);
    border-bottom:1px solid var(--border);
  }
  details.group > summary::-webkit-details-marker{ display:none; }
  .g-left{display:flex; align-items:center; gap:10px;}
  .caret{width:18px;height:18px; opacity:.75; transition:transform .2s ease;}
  details[open] .caret{ transform:rotate(180deg); }
  .g-title{ margin:0; font-size:15px; letter-spacing:.3px; text-transform:uppercase; color:var(--muted); }
  .g-meta{ font-size:12px; color:var(--muted); }

  /* Regi√≥n de contenido con scroll interno estable */
  .g-content{ max-height:70vh; overflow:auto; padding:14px; }

  /* ===== GRID ===== */
  .grid{
    display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px;
  }
  .card{
    display:flex; flex-direction:column; background:var(--card); color:var(--fg);
    border:1px solid var(--border); border-radius:var(--radius-sm); box-shadow:var(--shadow);
    transition:transform .18s ease, border-color .18s ease; overflow:hidden;
  }
  .card:hover{ transform:translateY(-2px); border-color:rgba(99,102,241,.35); }

  /* ===== MINIATURA (live) ===== */
  .thumb{
    position:relative;
    aspect-ratio: 16/9;
    background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
    border-bottom:1px solid var(--border);
    overflow:hidden;
  }
  .thumb .thumb-blank{
    position:absolute; inset:0; display:grid; place-items:center; color:var(--muted); font-size:12px;
    transition: opacity .2s ease;
  }
  .thumb iframe{
    position:absolute; top:0; left:0;
    width:1200px; height:675px; /* 16:9 base */
    transform-origin: top left;
    border:0; background:white; pointer-events:none;
  }
  .thumb.error .thumb-blank{ display:grid; }
  .thumb.error iframe{ display:none; }

  .card-body{ padding:12px; display:flex; flex-direction:column; gap:8px; min-height:140px; }
  .badge{ font-size:11px; color:var(--muted); display:flex; align-items:center; gap:6px;}
  .title-sm{ font-size:15px; margin:2px 0 0; line-height:1.25; }
  .desc{ color:var(--muted); font-size:13px; min-height:2.2em; }
  .tags{ display:flex; gap:6px; flex-wrap:wrap; }
  .tag{ font-size:11px; padding:3px 8px; border:1px solid var(--border); border-radius:999px; color:var(--muted); }

  .actions{ margin-top:auto; display:flex; gap:8px; align-items:center; }
  .btn-link, .icon-btn{
    border:1px solid var(--border); background:var(--panel); color:var(--fg);
    border-radius:10px; height:40px; display:grid; place-items:center;
  }
  .btn-link{ padding:0 12px; font-weight:700; text-decoration:none; flex:1; }
  .icon-btn{ width:40px; cursor:pointer; }

  /* ===== PREVIEW ===== */
  .preview{
    position:fixed; width:520px; height:360px; display:none; z-index:60;
    border:1px solid var(--border); background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;
  }
  .preview.floating{ inset:auto auto 0 0; }
  .preview.docked{ right:18px; top:90px; display:block; }
  .preview header{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:8px 10px; border-bottom:1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  }
  .frame-wrap{ position:relative; width:100%; height:100%; background:var(--panel); }
  .preview iframe{
    position:absolute; inset:auto auto 0 0;
    width:1200px; height:800px; transform-origin:bottom left;
    transform:scale(var(--pv-scale)); border:0; background:white;
    pointer-events:none;
  }
  .preview.interactive iframe{ pointer-events:auto; }
  .fallback{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; text-align:center; color:var(--muted); padding:24px; font-size:14px; }
  .preview.error .fallback{ display:flex; }
  .preview.error iframe{ display:none; }

  /* ===== util ===== */
  #links{ display:none; }
  .toast{
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    background:var(--panel); border:1px solid var(--border); color:var(--fg);
    padding:10px 14px; border-radius:10px; box-shadow:var(--shadow); z-index:80; font-size:13px; display:none;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo">üìä</div>
        <div>
          <h1>Mi Biblioteca de Gr√°ficos</h1>
          <div class="muted">Portafolio ‚Ä¢ Quick look con üëÅ ‚Ä¢ Enter para abrir ‚Ä¢ üìå para fijar</div>
        </div>
      </div>
      <div class="tools">
        <div class="search">
          <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M21 21l-4.3-4.3m1.8-4.2a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z"/></svg>
          <input id="q" type="search" placeholder="Buscar por t√≠tulo, archivo o etiqueta‚Ä¶" aria-label="Buscar" />
        </div>
        <button class="btn" id="toggleTheme" title="Claro/Oscuro">üåô</button>
      </div>
    </header>

    <!-- GRUPOS -->
    <section id="groups" class="groups"></section>

    <!-- PREVIEW -->
    <div id="preview" class="preview floating" role="dialog" aria-label="Vista previa" aria-hidden="true">
      <header>
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <span class="tag" id="pvFile" style="border:1px solid var(--border);padding:4px 8px;border-radius:999px;color:var(--muted)">archivo.html</span>
          <span class="muted" id="pvHint">Vista previa (solo lectura)</span>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <label class="muted" for="pvScale" style="font-size:12px;">Zoom</label>
          <input id="pvScale" type="range" min="25" max="70" value="37" />
          <button class="btn" id="pvInteract" title="Permitir interacci√≥n">üñ±Ô∏è</button>
          <button class="btn" id="pvDock" title="Anclar/Desanclar">üìå</button>
          <button class="btn" id="pvClose" title="Cerrar">‚úï</button>
        </div>
      </header>
      <div class="frame-wrap">
        <iframe id="pvFrame" referrerpolicy="no-referrer"></iframe>
        <div class="fallback" id="pvFallback">No se pudo cargar la vista previa. Abre el archivo para verlo.</div>
      </div>
    </div>

    <!-- Fuente oculta (tu lista) -->
    <ul id="links" style="display:none">
<li><a href="burbujas-3.html" target="_blank" data-desc="Burbujas din√°micas en el tiempo" data-tags="burbujas, timeline, saneamiento">burbujas-3</a></li>
      <li><a href="Burbujas-Inversiones-MEF.html" target="_blank" data-desc="Burbujas din√°micas en el tiempo-Avance-PIM" data-tags="burbujas, timeline, inversiones">burbujas-inversiones </a></li>
      <li><a href="Serie-Inversiones-NG.html" target="_blank" data-desc="Inversiones PIM por nivel de gobierno Saneamiento" data-tags="serie, timeline, saneamiento">Inversiones PIM Saneamiento por Nivel de Gobierno</a></li>
      <li><a href="Serie-Inversiones-Total.html" target="_blank" data-desc="Inversiones PIM Total Saneamiento" data-tags="serie, timeline, saneamiento">Inversiones PIM Saneamiento por Nacional total</a></li>
      <li><a href="Grafico-burbujas-continuidad.html" target="_blank" data-desc="Burbujas din√°micas en el tiempo-continuidad" data-tags="burbujas, timeline, saneamiento">burbujas-continuidad</a></li>
      <li><a href="Grafico-burbujas-Alc-cloroR.html" target="_blank" data-desc="Burbujas din√°micas en el tiempo-continuidad-Alc-cloroR" data-tags="burbujas, timeline, saneamiento">burbujas-continuidad-Alc-CloroR</a></li>
      <li><a href="Grafico-burbujas-BD-SAN.html" target="_blank" data-desc="GRAFICO BB-BD-SAN" data-tags="Burbujas,">Grafico Burubujas SAN-BD</a></li>
      <li><a href="Grafico-burbujas-BD-SAN-ENAPRES.html" target="_blank" data-desc="GRAFICO BB-BD-SAN-ENAPRES" data-tags="Burbujas,">Grafico Burubujas SAN-BD-ENAPRES</a></li>
      <li><a href="Grafico-burbujas-BD-SAN-ENAPRES-FLTR.html" target="_blank" data-desc="GRAFICO BB-BD-SAN-ENAPRES-Filtro" data-tags="Burbujas,">Grafico Burubujas SAN-BD-ENAPRES-Filtro</a></li>
      <li><a href="Grafico-burbujas-BD-SAN-ENAPRES-CL-Cont-FLTR.html.html" target="_blank" data-desc="GRAFICO BB-BD-SAN-ENAPRES-Cl-Cont-Filtro" data-tags="Burbujas,">Grafico Burubujas SAN-BD-ENAPRES-Cl-Cont-Filtro</a></li>
      <li><a href="serie-Porcentaje-AccesoAP.html" target="_blank" data-desc="serie %Acceso a AP" data-tags="series, d√©ficit, vivienda, ENAHO">serie %Acceso a AP</a></li>
      <li><a href="serie-Porcentaje-AccesoAP-ENAPRES.html" target="_blank" data-desc="serie %Acceso a AP" data-tags="series, d√©ficit, vivienda, ENAPRES">serie %Acceso a AP-ENAPRES</a></li>
      <li><a href="serie-Porcentaje-AccesoALC.html" target="_blank" data-desc="serie %Acceso a ALC" data-tags="series, d√©ficit, ENAHO, alcantarillado">serie %Acceso a ALC</a></li>
      <li><a href="serie-Porcentaje-AccesoALC-ENAPRES.html" target="_blank" data-desc="serie %Acceso a ALC" data-tags="series, ENAPRES, alcantarillado ">serie %Acceso a ALC-ENAPRES</a></li>
      <li><a href="serie-Porcentaje-PobenHogcCl.html" target="_blank" data-desc="serie %Pob en Hogares con acceso a Cl adecuado" data-tags="series, d√©ficit, vivienda">serie %Pob en Hogares con acceso a Cl adecuado</a></li>
      <li><a href="serie-Porcentaje-PobenHogcCl-ENAPRES.html" target="_blank" data-desc="serie %Pob en Hogares con acceso a Cl adecuado-ENAPRES" data-tags="series, saneamiento, cloro, ENAPRES">serie %Pob en Hogares con acceso a Cl adecuado-ENAPRES</a></li>
      <li><a href="serie-Porcentaje-Continuidad-20-24h.html" target="_blank" data-desc="serie %Continuidad 20-24h" data-tags="series, d√©ficit, vivienda">serie %Continuidad 20-24h</a></li>
      <li><a href="serie-Continuidad-horas-ENAPRES.html" target="_blank" data-desc="serie Continuidad (h) " data-tags="series, continuidad, ENAPRES">serie Continuidad en horas-ENAPRES</a></li>
      <li><a href="serie-Porcentaje-PobContinuidad20y24-ENAPRES.html" target="_blank" data-desc="serie %Continuidad 20-24h-ENAPRES" data-tags="series, saneamiento, ENAPRES">serie %Pob Continuidad 20 y 24h-ENAPRES</a></li>
      <li><a href="serie-Porcentaje-Hogxpersona-recoge-agua-ENAPRES.html" target="_blank" data-desc="serie-Porcentaje-Hogxpersona-recoge-agua-ENAPRES" data-tags="series, saneamiento, ENAPRES">serie-Porcentaje de hogares x quien recoge agua-ENAPRES</a></li>
      <li><a href="serie-PIMvsDEV-Inversiones-Saneamiento.html" target="_blank" data-desc="serie PIM vs Devengado por nivel de gobierno- Dep ejecutora" data-tags="series, saneamiento, inversiones">serie Pim vs Devengado Saneamiento por nivel de gobierno y Dep ejecutora</a></li>
      <li><a href="serie-PIMvsDEV-Inversiones-Saneamiento-Filtro.html" target="_blank" data-desc="serie PIM vs Devengado por nivel de gobierno- Dep ejecutora-Filtro" data-tags="series, saneamiento, inversiones">serie Pim vs Devengado Saneamiento por nivel de gobierno y Dep ejecutora-Filtro</a></li>
      <li><a href="serie-Inversiones-PIMxNG-Ejecutora-Saneamiento.html" target="_blank" data-desc="serie PIM por nivel de gobierno- Dep ejecutora" data-tags="series, saneamiento, inversiones">serie Pim Saneamiento por nivel de gobierno y Dep ejecutora</a></li>
      <li><a href="serie-Inversiones-PIMxNG-Ejecutora-Saneamiento-ETES.html" target="_blank" data-desc="serie PIM por nivel de gobierno- Dep ejecutora-ETES" data-tags="series, saneamiento, inversiones">serie Pim Saneamiento por nivel de gobierno y Dep ejecutora-ETES</a></li>
      <li><a href="serie-Inversiones-DEVxNG-Ejecutora-Saneamiento.html" target="_blank" data-desc="serie DEV por nivel de gobierno- Dep ejecutora" data-tags="series, saneamiento, inversiones">serie Dev Saneamiento por nivel de gobierno y Dep ejecutora</a></li>
      <li><a href="serie-Inversiones-PAvancexNG-Ejecutora-Saneamiento.html" target="_blank" data-desc="serie P Avance por nivel de gobierno- Dep ejecutora" data-tags="series, saneamiento, inversiones">serie P Avance Saneamiento por nivel de gobierno y Dep ejecutora</a></li>
      <li><a href="serie-Inversiones-PAvancexNG-Ejecutora-Saneamiento-ETES.html" target="_blank" data-desc="serie P Avance por nivel de gobierno- Dep ejecutora - ETES" data-tags="series, saneamiento, inversiones">serie P Avance Saneamiento por nivel de gobierno y Dep ejecutora - ETES</a></li>
      <li><a href="serie-defhab-4.html" target="_blank" data-desc="Variaci√≥n por a√±os, versi√≥n 4" data-tags="series, d√©ficit, vivienda">series deficit nacional%4</a></li>
      <li><a href="serie_recuentohab_cuali_cuanti.html" target="_blank" data-desc="Variaci√≥n por a√±os, " data-tags="series, d√©ficit, vivienda">series deficit totales habitacional cuali cuanti</a></li>
      <li><a href="serie-habitacional-total-cuali-cuanti-porcent.html" target="_blank" data-desc="Variaci√≥n por a√±os, " data-tags="series, d√©ficit, vivienda">series deficit totales habitacional cuali cuanti-porcentaje</a></li>
      <li><a href="serie-defhababs-1.html" target="_blank" data-desc="D√©ficit habitacional (valores absolutos)" data-tags="series, absolutos, vivienda">series deficit nacional(abs)1</a></li>
      <li><a href="serie-defcuanti-enaho-1.html" target="_blank" data-desc="D√©ficit cuantitativo (ENAHO)" data-tags="enaho, cuantitativo, vivienda">series deficit nacional cuanti 1</a></li>
      <li><a href="serie-defcuali-enaho-1.html" target="_blank" data-desc="D√©ficit cualitativo (ENAHO)" data-tags="enaho, cualitativo, vivienda">series deficit nacional cuali 1</a></li>
      <li><a href="Deficit_x_area_residencia.html" target="_blank" data-desc="D√©ficit habitacional por √°rea de residencia" data-tags="D√©ficit, residencia, rural, urbano, vivienda">D√©ficit habitacional por √°rea de residencia</a></li>
      <li><a href="Deficit_cuanti_x_area_residencia.html" target="_blank" data-desc="D√©ficit cuantitativo por √°rea de residencia" data-tags="D√©ficit, cuantitativo, residencia, rural, urbano, vivienda">D√©ficit cuantitativo por √°rea de residencia</a></li>
      <li><a href="Deficit_cuali_x_area_residencia.html" target="_blank" data-desc="D√©ficit cualitativo por √°rea de residencia" data-tags="D√©ficit, cualitativo, residencia, rural, urbano, vivienda">D√©ficit cualitativo por √°rea de residencia</a></li>
      <li><a href="serie-creditosFMVtotal.html" target="_blank" data-desc="Total Cr√©ditos FMV" data-tags="Cr√©ditos, FMV, Fondo,">Total Creditos FMV</a></li>
      <li><a href="serie-BBP-INT-SOST.html" target="_blank" data-desc="Total Bonos FMV" data-tags="Bonos, FMV, Fondo,">BONOS FMV</a></li>
      <li><a href="serie-unit-bbp.html" target="_blank" data-desc="Total Bonos FMV Unit" data-tags="Bonos, FMV, Fondo,">BONOS FMV BBP UNIT</a></li>
      <li><a href="serie-unit-bbp-sost.html" target="_blank" data-desc="Total Bonos FMV Unit" data-tags="Bonos, FMV, Fondo,">BONOS FMV BBP SOST UNIT</a></li>
      <li><a href="serie-unit-bbp-int.html" target="_blank" data-desc="Total Bonos FMV Unit" data-tags="Bonos, FMV, Fondo,">BONOS FMV BBP INT UNIT</a></li>
      <li><a href="serie-bonos-techo-propio-total.html" target="_blank" data-desc="Total Bonos Techo Propio" data-tags="Bonos, techo propio, Fondo,">BONOS TECHO PROPIO TOTAL</a></li>
      <li><a href="mapa-creditos-fmv.html" target="_blank" data-desc="Mapa total de creditos FMV" data-tags="creditos, FMV, Fondo,">MAPA TOTAL CREDITOS FM</a></li>
      <li><a href="acceso-ap-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">acceso ap PRUEBA ENAPRES</a></li>
      <li><a href="acceso-alc-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">acceso Alc PRUEBA ENAPRES</a></li>
      <li><a href="continuidad-horas-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">continuidad (h) PRUEBA ENAPRES</a></li>
      <li><a href="continuidad-20-24-7dias-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">continuidad 20-24 h -7  dias PRUEBA ENAPRES</a></li>
      <li><a href="cloro-aceptable-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">Cloro adecuado PRUEBA ENAPRES</a></li>
      <li><a href="burbujas-saneamiento-enapres-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">Burbujas-Saneamiento-Filtro PRUEBA ENAPRES</a></li>
      <li><a href="burbujas-inversiones-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">Burbujas-inversiones-prueba</a></li>
      <li><a href="Burbujas-inversiones-depmeta-prueba.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">Burbujas-inversiones-depmeta-prueba</a></li>
      <li><a href="Burbujas-PIM-DEV-NG-PRUEBA.html" target="_blank" data-desc="PRUEBA" data-tags="PRUEBA,">Burbujas-inversiones-PIM_DEV_NG-prueba</a></li>
    </ul>
  </div>

  <div class="toast" id="toast"></div>

<script>
  const $=(q,el=document)=>el.querySelector(q);
  const $$=(q,el=document)=>Array.from(el.querySelectorAll(q));

  const groupsEl=$('#groups');
  const preview=$('#preview'), pvFrame=$('#pvFrame'), pvFile=$('#pvFile'), pvFallback=$('#pvFallback');
  const pvScale=$('#pvScale'), pvDock=$('#pvDock'), pvClose=$('#pvClose'), pvInteract=$('#pvInteract');
  const qEl=$('#q'), toggleThemeBtn=$('#toggleTheme');
  const toastEl=$('#toast');

  /* THEME */
  (function(){
    const KEY='ui-theme';
    const saved=localStorage.getItem(KEY);
    if(saved) document.documentElement.setAttribute('data-theme', saved);
    toggleThemeBtn.textContent=document.documentElement.getAttribute('data-theme')==='dark'?'üåô':'‚òÄÔ∏è';
    toggleThemeBtn.addEventListener('click',()=>{
      const curr=document.documentElement.getAttribute('data-theme');
      const next=curr==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme',next);
      localStorage.setItem(KEY,next);
      toggleThemeBtn.textContent=next==='dark'?'üåô':'‚òÄÔ∏è';
    });
  })();

  /* DATA */
  const items=$$('#links a').map(a=>({
    href:a.getAttribute('href'),
    text:(a.textContent||'').trim(),
    desc:a.dataset.desc||'',
    tags:(a.dataset.tags||'').split(',').map(s=>s.trim()).filter(Boolean)
  }));

  function extIcon(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9l-6-6zm1 7h5l-6-6v5a1 1 0 0 0 1 1z"/></svg>`;}
  function linkIcon(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M10.59 13.41a1.98 1.98 0 0 0 0-2.82l2.59-2.59a2 2 0 1 1 2.83 2.83l-1.42 1.41"/><path d="M13.41 10.59a1.98 1.98 0 0 0 0 2.82l-2.59 2.59a2 2 0 1 1-2.83-2.83l1.42-1.41"/></svg>`;}
  function eyeIcon(){return `<svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 5c-7 0-10 7-10 7s3 7 10 7 10-7 10-7-3-7-10-7zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>`;}
  function copyIcon(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/></svg>`;}
  function codeIcon(){return `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 17l-5-5 5-5M16 7l5 5-5 5M13 6l-2 12"/></svg>`;}

  /* ===== AGRUPACI√ìN ===== */
  const GROUP_RULES={ ENAPRES:['enapres'], MAPA:['mapa'], OTROS:[] };
  function normalize(it){return (it.text+' '+it.href+' '+it.desc+' '+it.tags.join(' ')).toLowerCase();}
  function categorize(it){
    const t=normalize(it);
    for(const k of ['ENAPRES','MAPA']) if(GROUP_RULES[k].some(w=>t.includes(w))) return k;
    return 'OTROS';
  }

  /* ===== MINIATURA helpers ===== */
  function sizeThumb(thumb){
    const frame = thumb.querySelector('iframe');
    if(!frame) return;
    const w = thumb.clientWidth || 1;
    const scale = w / 1200; // 1200x675 base
    frame.style.transform = `scale(${scale})`;
  }
  function makeThumb(href){
    const t = document.createElement('div');
    t.className = 'thumb';
    t.dataset.href = href;
    t.innerHTML = `<div class="thumb-blank">Cargando miniatura‚Ä¶</div>`;
    return t;
  }
  // *** IMPORTANTE: versi√≥n con allow-scripts + allow-same-origin ***
  function loadThumb(thumb){
    if(thumb.dataset.loaded) return;
    const href = thumb.dataset.href;
    const iframe = document.createElement('iframe');
    iframe.referrerPolicy = 'no-referrer';
    iframe.sandbox = 'allow-scripts allow-same-origin';
    iframe.loading = 'lazy';

    const fallback = thumb.querySelector('.thumb-blank');
    let sized = false;

    iframe.addEventListener('load', ()=>{
      try{
        const doc = iframe.contentDocument;
        const painted = doc && (doc.querySelector('canvas') || doc.querySelector('[class*=echart]'));
        if(painted) fallback.style.opacity='0';
        else fallback.style.opacity='0'; // quitamos loader igual tras load
      }catch(_){
        fallback.style.opacity='0';
      }
      if(!sized){ sizeThumb(thumb); sized = true; }
      setTimeout(()=>{ fallback.style.display='none'; }, 200);
    });

    iframe.addEventListener('error', ()=>{
      thumb.classList.add('error');
      fallback.textContent = 'Miniatura no disponible';
    });

    iframe.src = href;
    thumb.appendChild(iframe);
    thumb.dataset.loaded = '1';
    sizeThumb(thumb);
  }

  /* UI */
  function makeCard(it, idx){
    const el=document.createElement('article');
    el.className='card'; el.tabIndex=0; el.dataset.index=idx;

    const thumb = makeThumb(it.href);
    el.appendChild(thumb);

    el.insertAdjacentHTML('beforeend', `
      <div class="card-body">
        <div class="badge">${extIcon()} <span>${it.href}</span></div>
        <h3 class="title-sm">${it.text}</h3>
        <p class="desc">${it.desc||'Sin descripci√≥n'}</p>
        <div class="tags">${it.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
        <div class="actions">
          <a class="btn-link" href="${it.href}" target="_blank" rel="noopener">${linkIcon()} Abrir</a>
          <button class="icon-btn peek" title="Vista previa">${eyeIcon()}</button>
          <button class="icon-btn copy" title="Copiar enlace">${copyIcon()}</button>
          <button class="icon-btn embed" title="Copiar iframe">${codeIcon()}</button>
        </div>
      </div>
    `);

    el.querySelector('.peek').addEventListener('click', (e)=>{ e.stopPropagation(); quickLook(it, el); });
    el.querySelector('.copy').addEventListener('click', ()=> copyLink(it.href));
    el.querySelector('.embed').addEventListener('click', ()=> copyIframe(it.href));
    el.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ window.open(it.href,'_blank','noopener'); } });

    observeThumb(thumb);
    return el;
  }

  function render(list){
    const term=qEl.value.trim().toLowerCase();
    const filtered = term ? list.filter(it => normalize(it).includes(term)) : list.slice();

    const groups={ENAPRES:[],MAPA:[],OTROS:[]};
    filtered.forEach((it,i)=> groups[categorize(it)].push({it,i}));

    groupsEl.innerHTML='';
    const order=[
      {key:'ENAPRES',title:'Fichero: ENAPRES'},
      {key:'MAPA',title:'Fichero: MAPA'},
      {key:'OTROS',title:'Fichero: OTROS'}
    ];

    for(const g of order){
      const rows=groups[g.key]; if(!rows.length) continue;
      const d=document.createElement('details');
      d.className='group'; // inicia contra√≠do
      d.innerHTML=`
        <summary>
          <div class="g-left">
            <svg class="caret" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 10l5 5 5-5"/></svg>
            <h2 class="g-title">${g.title}</h2>
          </div>
          <div class="g-meta">${rows.length} elemento(s)</div>
        </summary>
        <div class="g-content">
          <div class="grid" data-grid></div>
        </div>
      `;
      const grid=d.querySelector('[data-grid]');
      rows.forEach(({it,i})=> grid.appendChild(makeCard(it,i)));
      groupsEl.appendChild(d);

      d.addEventListener('toggle', ()=>{
        if(d.open){
          document.querySelectorAll('.thumb').forEach(sizeThumb);
        }
      });
    }
  }

  /* PREVIEW */
  function positionPreviewByEl(el){
    const pad=16, w=520, h=360;
    const r=el.getBoundingClientRect();
    let x=r.right+12, y=r.top;
    const vw=innerWidth, vh=innerHeight;
    if(x+w+pad>vw) x=Math.max(pad, r.left-w-12);
    if(y+h+pad>vh) y=vh-h-pad;
    preview.style.left=Math.max(pad,x)+'px';
    preview.style.top =Math.max(pad,y)+'px';
  }
  function quickLook(it, cardEl){
    const sticky=preview.dataset.sticky==='1';
    if(sticky && !preview.classList.contains('docked')){
      preview.dataset.sticky=''; preview.style.display='none'; pvFrame.removeAttribute('src'); return;
    }
    preview.style.display='block';
    preview.dataset.sticky='1';
    preview.classList.remove('error');
    pvFile.textContent=it.href;
    pvFrame.removeAttribute('src'); pvFrame.src=it.href;
    if(!preview.classList.contains('docked')){ preview.classList.add('floating'); positionPreviewByEl(cardEl); }
    preview.setAttribute('aria-hidden','false');
  }
  pvClose.addEventListener('click', ()=>{ preview.dataset.sticky=''; preview.classList.remove('docked','interactive'); preview.style.display='none'; pvFrame.removeAttribute('src'); });
  pvDock.addEventListener('click', ()=>{ const d=preview.classList.toggle('docked'); if(d){ preview.style.display='block'; preview.dataset.sticky='1'; preview.classList.remove('floating'); } else { preview.classList.add('floating'); } });
  pvInteract.addEventListener('click', ()=>{ preview.classList.toggle('interactive'); pvInteract.textContent = preview.classList.contains('interactive')?'üö´':'üñ±Ô∏è'; pvInteract.title = preview.classList.contains('interactive')?'Bloquear interacci√≥n':'Permitir interacci√≥n'; });
  pvScale.addEventListener('input', ()=>{ document.documentElement.style.setProperty('--pv-scale', (pvScale.value/100).toString()); });
  pvFrame.addEventListener('error', ()=> preview.classList.add('error'));
  pvFrame.addEventListener('load', ()=>{ try{ const ok=pvFrame.contentDocument && pvFrame.contentDocument.body && pvFrame.contentDocument.body.innerHTML.trim()!==''; preview.classList.toggle('error', !ok); if(!ok) pvFallback.textContent='Este archivo no permite vista previa embebida.'; }catch(_){ preview.classList.add('error'); pvFallback.textContent='Este archivo no permite vista previa embebida.'; } });

  /* COPY & SEARCH */
  async function copyLink(href){
    try{ await navigator.clipboard.writeText(new URL(href, location.href).toString()); ping('Enlace copiado'); }
    catch{ ping('No se pudo copiar'); }
  }
  async function copyIframe(href){
    const url=new URL(href, location.href).toString();
    const code=`<iframe src="${url}" width="100%" height="480" frameborder="0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`;
    try{ await navigator.clipboard.writeText(code); ping('C√≥digo iframe copiado'); }
    catch{ ping('No se pudo copiar'); }
  }
  function ping(msg){
    toastEl.textContent=msg; toastEl.style.display='block'; toastEl.style.opacity='1';
    clearTimeout(toastEl._t); toastEl._t=setTimeout(()=> toastEl.style.display='none',1300);
  }
  qEl.addEventListener('input', ()=> render(items));

  /* OBSERVERS para miniaturas (lazy) */
  const thumbIO = new IntersectionObserver((entries)=>{
    for(const e of entries){
      if(e.isIntersecting){
        loadThumb(e.target);
        thumbIO.unobserve(e.target);
      }
    }
  }, { root:null, rootMargin:'150px', threshold:0.01 });

  function observeThumb(el){ thumbIO.observe(el); }

  window.addEventListener('resize', ()=>{
    document.querySelectorAll('.thumb').forEach(sizeThumb);
  });

  /* INIT */
  render(items);
</script>
</body>
</html>

