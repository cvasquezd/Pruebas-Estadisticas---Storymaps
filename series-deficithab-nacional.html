<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>% Total / Urbano / Rural — Línea dinámica por año</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <style>
    :root{
      --bg:#ffffff;
      --fg:#111827;
      --muted:#6b7280;
      --card:#fafafa;
      --shadow:0 4px 20px rgba(0,0,0,.08);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #wrap{max-width:1100px;margin:20px auto;padding:0 14px}
    h1{font-weight:700;font-size:20px;margin:0 0 10px}
    .sub{color:var(--muted);font-size:13px;margin:0 0 14px}
    #chart{height:70vh;min-height:480px;background:var(--card);border-radius:16px;box-shadow:var(--shadow)}
    #err{margin-top:10px;color:#b91c1c;font-size:12px;white-space:pre-wrap}
  </style>
</head>
<body>
<div id="wrap">
  <h1>% Total / Urbano / Rural por año (cod_var = 45)</h1>
  <p class="sub">Fuente: ArcGIS FeatureServer · Tabla 6: <code>vw_story_indicador_vivienda_03</code></p>
  <div id="chart"></div>
  <div id="err"></div>
</div>

<script>
(async function(){
  // === 1) CONFIGURA TU SERVICIO =============================================
  const SERVICE_URL = "https://pportalgis.vivienda.gob.pe/phtserver/rest/services/Hosted/mapa_swipe_viviendas_promovidas_storymap_hosted/FeatureServer/6/query";

  // Traer SOLO NACIONAL y años 2017..2024
  const WHERE = "cod_var = 45 AND region_nombre = 'NACIONAL' AND anio BETWEEN 2017 AND 2024";

  // Años esperados explícitos (asegura el eje X y la animación aun si falta alguno)
  const YEARS = ["2017","2018","2019","2020","2021","2022","2023","2024"];

  // === 2) MENSAJES PERSONALIZABLES PARA LOS PICOS ============================
  const peakMessages = {
    total:  { /* "2020": "Mensaje para TOTAL 2020" */ },
    urbano: { /* "2021": "Mensaje para URBANO 2021" */ },
    rural:  { /* "2019": "Mensaje para RURAL 2019" */ }
  };

  // === 3) UTILIDADES ================
